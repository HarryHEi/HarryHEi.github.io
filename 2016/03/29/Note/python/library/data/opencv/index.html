<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Ben Wong,wenbinben@gmail.com"><title>opencv · Harryx</title><meta name="description" content="简述因为比赛的需要，学习图像识别，就用比较简单的Python来编写
安装python2.7 安装 opencv 参考：http://www.jianshu.com/p/67293b547261
像素访问opencv图像是二维或者三维numpy.array8-bit 灰度图像是一个二维数组24-bit"><meta name="keywords" content="Hexo,HTML,Ben,CSS,安卓,android,Linux,linuxdeepin"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title><a href="/">Harryx</a></h3><div class="description"><p>good good study good good play~</p></div></div></div><ul class="social-links"><li><a href="https://twitter.com/harryx520"><i class="fa fa-twitter"></i></a></li><li><a href="http://weibo.com/Booooyakasha"><i class="fa fa-weibo"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="http://beian.miit.gov.cn/" target="_blank">苏ICP备19072417号-1</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/links">友链</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/avator.jpg"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>opencv</a></h3></div><div class="post-content"><h1 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h1><p>因为比赛的需要，学习图像识别，就用比较简单的Python来编写</p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>python2.7 安装 opencv 参考：<br><a href="http://www.jianshu.com/p/67293b547261" target="_blank" rel="noopener">http://www.jianshu.com/p/67293b547261</a></p>
<h1 id="像素访问"><a href="#像素访问" class="headerlink" title="像素访问"></a>像素访问</h1><p>opencv图像是二维或者三维numpy.array<br>8-bit 灰度图像是一个二维数组<br>24-bit BGR图像是一个三位数组<br>cv2中对图片像素的访问和在numpy中一样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">img[&lt;height&gt;, &lt;width&gt;, &lt;channel&gt;]</span><br></pre></td></tr></table></figure></p>
<p>三个参数分别表示行，列，通道</p>
<h1 id="读取并显示图像"><a href="#读取并显示图像" class="headerlink" title="读取并显示图像"></a>读取并显示图像</h1><h2 id="最简单的程序"><a href="#最简单的程序" class="headerlink" title="最简单的程序"></a>最简单的程序</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line"></span><br><span class="line">&quot;显示一个图形&quot;</span><br><span class="line"></span><br><span class="line">import cv2</span><br><span class="line"></span><br><span class="line">img = cv2.imread(&quot;pic.jpg&quot;)</span><br><span class="line">cv2.namedWindow(&quot;Image&quot;)</span><br><span class="line">cv2.imshow(&quot;Image&quot;, img)</span><br><span class="line">cv2.waitKey(0)</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<h3 id="imread"><a href="#imread" class="headerlink" title="imread"></a>imread</h3><p>载入图片<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imread(&lt;filename&gt;, &lt;flags&gt;)</span><br></pre></td></tr></table></figure></p>
<p>以BGR(blue-green-red)格式读取图片，和RGB类似，不过顺序相反<br>第一个参数是文件名<br>第二个参数是载入标识<br>1 : cv2.IMREAD_COLOR (BGR) (默认)<br>0 : cv2.IMREAD_GRAYSCALE (grayscale)<br>-1 : cv2.IMREAD_UNCHANGED (由图片本身决定)</p>
<ul>
<li>flags &gt;0返回一个3通道的彩色图像。</li>
<li>flags =0返回灰度图像。</li>
<li>flags &lt;0返回包含Alpha通道的加载的图像。</li>
</ul>
<h3 id="namedWindow"><a href="#namedWindow" class="headerlink" title="namedWindow"></a>namedWindow</h3><p>创建一个窗口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">namedWindow(&lt;winname&gt;, &lt;flags&gt;)</span><br></pre></td></tr></table></figure></p>
<p>第一个参数是窗口名称<br>第二个参数是窗口标识，通常使用默认<br>可以调用<strong>destroyWindow()</strong>或者<strong>destroyAllWindow()</strong>关闭窗口<br>对于已经存在的同名窗口，函数不做任何事</p>
<h3 id="imshow"><a href="#imshow" class="headerlink" title="imshow"></a>imshow</h3><p>在指定窗口显示一幅图像<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imshow(&lt;winname&gt;, &lt;inputarrat&gt;)</span><br></pre></td></tr></table></figure></p>
<p>第一个参数是窗口名称<br>第二个参数是显示的图像</p>
<h3 id="imwrite"><a href="#imwrite" class="headerlink" title="imwrite"></a>imwrite</h3><p>输出图像到文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imwrite(&lt;filename&gt;, &lt;inputarray&gt;, &lt;params&gt;)</span><br></pre></td></tr></table></figure></p>
<p>第一个参数是文件名，带上后缀，比如“.jpg”<br>第二个参数是图像数据<br>第三个参数是参数编码，一般不需要填写</p>
<ul>
<li>对于JPEG格式图片，这个参数表示0到100的图片质量(IMWRITE_JPEG_QUALITY)<strong>(1)</strong>，默认95</li>
<li>对于PNG格式图片，这个参数表示压缩级别(IMWRITE_PNG_COMPRESSION)<strong>(16)</strong>从0到9，默认3</li>
<li>对于PPM，PGM，PBM格式的图片，这个参数表示一个二进制格式标志(IMWRITE_PXM_BINARY)<strong>(32)</strong>，取值0或1，默认为1</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#cv2.imwrite(&quot;lalala.jpg&quot;, img, [1,20])</span><br><span class="line">cv2.imwrite(&quot;lalala.jpg&quot;, img, [cv2.IMWRITE_JPEG_QUALITY,20])</span><br></pre></td></tr></table></figure>
<h2 id="图像操作"><a href="#图像操作" class="headerlink" title="图像操作"></a>图像操作</h2><h3 id="img-shape"><a href="#img-shape" class="headerlink" title="img.shape"></a>img.shape</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&lt;height&gt;, &lt;width&gt;, &lt;channel&gt;)</span><br></pre></td></tr></table></figure>
<p>返回值是一个元组，对应的值是图片的高，宽，通道</p>
<h3 id="img-ndim查看图片维度"><a href="#img-ndim查看图片维度" class="headerlink" title="img.ndim查看图片维度"></a>img.ndim查看图片维度</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#椒盐现象</span><br><span class="line">def salt(img, n):</span><br><span class="line">    for a in range(n):</span><br><span class="line">        i = int(random.random() * img.shape[0])</span><br><span class="line">        j = int(random.random() * img.shape[1])</span><br><span class="line">        img[i , j] = [255, 255, 255] #blue, green, red</span><br></pre></td></tr></table></figure>
<h3 id="img-split"><a href="#img-split" class="headerlink" title="img.split"></a>img.split</h3><p>分离通道<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b, g, r = cv2.split(img)</span><br></pre></td></tr></table></figure></p>
<p>或者<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#这里是镜像</span><br><span class="line">b = img[:, :, 0]</span><br><span class="line">g = img[:, :, 1]</span><br><span class="line">r = img[:, :, 2]</span><br></pre></td></tr></table></figure></p>
<h3 id="cv2-merge"><a href="#cv2-merge" class="headerlink" title="cv2.merge"></a>cv2.merge</h3><p>通道合并<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">img = cv2.merge([b, g, r])</span><br></pre></td></tr></table></figure></p>
<h3 id="np-zeros"><a href="#np-zeros" class="headerlink" title="np.zeros"></a>np.zeros</h3><p>opencv中没有createimage接口，创建图像需要调用numpy的函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">img = np.zeros(&lt;img.shape&gt;, np.uint8)</span><br></pre></td></tr></table></figure></p>
<p>例如创建一个高500，宽400，3通道的图片<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">img = np.zeros((500, 400, 3), np.uint8)</span><br></pre></td></tr></table></figure></p>
<h3 id="img-copy"><a href="#img-copy" class="headerlink" title="img.copy()"></a>img.copy()</h3><p>通过拷贝一个numpy的array，拷贝一个图片</p>
<h3 id="cv2-cvtColor"><a href="#cv2-cvtColor" class="headerlink" title="cv2.cvtColor"></a>cv2.cvtColor</h3><p>改变颜色编码(color-space)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv2.cvtColor(&lt;image&gt;, &lt;flag&gt;)</span><br></pre></td></tr></table></figure></p>
<p>BGR -&gt; GRAY<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">img = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)</span><br></pre></td></tr></table></figure></p>
<p>BGR -&gt; HSV<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">img = cv2.cvtColor(img, cv2.COLOR_BGR2HSV)</span><br></pre></td></tr></table></figure></p>
<h3 id="cv2-calcHist"><a href="#cv2-calcHist" class="headerlink" title="cv2.calcHist"></a>cv2.calcHist</h3><p>绘制直方图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv2.calcHist([image], channels, mask, histSize, ranges)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>image: 输入图像，用方括号括起来</li>
<li>channels: 通道数</li>
<li>mask: 掩膜图像，如果是整幅图，为None</li>
<li>histSize: 灰度级个数</li>
<li>ranges: 直方图像素值范围，通常为[0, 256]</li>
</ul>
<h2 id="图像处理"><a href="#图像处理" class="headerlink" title="图像处理"></a>图像处理</h2><h3 id="cv2-erode"><a href="#cv2-erode" class="headerlink" title="cv2.erode"></a>cv2.erode</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">img = cv2.imread(&quot;j.png&quot;)</span><br><span class="line">#定义一个5X5全是1的矩阵</span><br><span class="line">kernel = np.ones((5,5),np.uint8)</span><br><span class="line">#腐蚀图像</span><br><span class="line">erosion = cv2.erode(img, kernel, iterations = 1)</span><br><span class="line"></span><br><span class="line">cv2.imwrite(&quot;j2.png&quot;,erosion)</span><br></pre></td></tr></table></figure>
<p><img src="http://7xrooc.com1.z0.glb.clouddn.com/ercode.png"></p>
<h3 id="cv2-dilate"><a href="#cv2-dilate" class="headerlink" title="cv2.dilate"></a>cv2.dilate</h3><p>膨胀图像<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">img = cv2.imread(&quot;j.png&quot;)</span><br><span class="line">#定义一个5X5全是1的矩阵</span><br><span class="line">kernel = np.ones((5,5),np.uint8)</span><br><span class="line">#膨胀图像</span><br><span class="line">erosion = cv2.dilate(img, kernel, iterations = 1)</span><br><span class="line">cv2.imwrite(&quot;j2.png&quot;,erosion)</span><br></pre></td></tr></table></figure></p>
<h3 id="opening"><a href="#opening" class="headerlink" title="opening"></a>opening</h3><p>开运算<br>开运算类似于腐蚀，应用于去除噪声<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">img = cv2.imread(&quot;j.png&quot;)</span><br><span class="line">#椒盐</span><br><span class="line">salt(img,200)</span><br><span class="line">cv2.imwrite(&quot;j2.png&quot;,img)</span><br><span class="line"></span><br><span class="line">#opening</span><br><span class="line">kernel = np.ones((5,5),np.uint8)</span><br><span class="line">opening = cv2.morphologyEx(img, cv2.MORPH_OPEN,kernel)</span><br><span class="line"></span><br><span class="line">cv2.imwrite(&quot;j3.png&quot;,opening)</span><br></pre></td></tr></table></figure></p>
<p><img src="http://7xrooc.com1.z0.glb.clouddn.com/salt-open.png"></p>
<h3 id="closeing"><a href="#closeing" class="headerlink" title="closeing"></a>closeing</h3><p>闭运算<br>闭运算和开运算相反，连接被分开的块<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opening = cv2.morphologyEx(img, cv2.MORPH_CLOSE,kernel)</span><br></pre></td></tr></table></figure></p>
<h3 id="threshold"><a href="#threshold" class="headerlink" title="threshold"></a>threshold</h3><p>二值化<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">retval, result = cv2.threshold(src, thresh, maxval, type[, dst])</span><br></pre></td></tr></table></figure></p>
<p>对应参数分别是：图片(灰度图)，阈值，最大值，类型<br>返回值分别为：阈值，结果图像<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line">from matplotlib import pyplot as plt</span><br><span class="line"></span><br><span class="line">img = cv2.imread(&apos;pic4.jpg&apos;,0)</span><br><span class="line">ret,thresh1 = cv2.threshold(img,127,255,cv2.THRESH_BINARY)</span><br><span class="line">ret,thresh2 = cv2.threshold(img,127,255,cv2.THRESH_BINARY_INV)</span><br><span class="line">ret,thresh3 = cv2.threshold(img,127,255,cv2.THRESH_TRUNC)</span><br><span class="line">ret,thresh4 = cv2.threshold(img,127,255,cv2.THRESH_TOZERO)</span><br><span class="line">ret,thresh5 = cv2.threshold(img,127,255,cv2.THRESH_TOZERO_INV)</span><br><span class="line"></span><br><span class="line">titles = [&apos;Original Image&apos;,&apos;BINARY&apos;,&apos;BINARY_INV&apos;,&apos;TRUNC&apos;,&apos;TOZERO&apos;,&apos;TOZERO_INV&apos;]</span><br><span class="line">images = [img, thresh1, thresh2, thresh3, thresh4, thresh5]</span><br><span class="line"></span><br><span class="line">for i in xrange(6):</span><br><span class="line">    plt.subplot(2,3,i+1),plt.imshow(images[i],&apos;gray&apos;)</span><br><span class="line">    plt.title(titles[i])</span><br><span class="line">    plt.xticks([]),plt.yticks([])</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure></p>
<p>自适应二值化，阈值会不断变化<br>cv2.ADAPTIVE_THRESH_MEAN_C的阈值是周围像素的灰度均值;<br>cv2.ADAPTIVE_THRESH_GAUSSIAN_C则是周围像素的高斯窗口加权和。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = cv2.adaptiveThreshold(src, maxValue, adaptiveMethod, thresholdType, blockSize,C)</span><br></pre></td></tr></table></figure></p>
<p>对应参数分别为：图片(单通道)，最大值，自适应方式，二值化方式，窗口大小，常数C<br>先求窗口灰度均值，然后减去常数C作为阈值<br>返回结果为：目标图像<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line">from matplotlib import pyplot as plt</span><br><span class="line"></span><br><span class="line">img = cv2.imread(&apos;pic4.jpg&apos;,0)</span><br><span class="line">img = cv2.medianBlur(img,5)</span><br><span class="line"></span><br><span class="line">ret,th1 = cv2.threshold(img,127,255,cv2.THRESH_BINARY)</span><br><span class="line">th2 = cv2.adaptiveThreshold(img,255,cv2.ADAPTIVE_THRESH_MEAN_C,\</span><br><span class="line">            cv2.THRESH_BINARY,11,2)</span><br><span class="line">th3 = cv2.adaptiveThreshold(img,255,cv2.ADAPTIVE_THRESH_GAUSSIAN_C,\</span><br><span class="line">            cv2.THRESH_BINARY,11,2)</span><br><span class="line"></span><br><span class="line">titles = [&apos;Original Image&apos;, &apos;Global Thresholding (v = 127)&apos;,</span><br><span class="line">            &apos;Adaptive Mean Thresholding&apos;, &apos;Adaptive Gaussian Thresholding&apos;]</span><br><span class="line">images = [img, th1, th2, th3]</span><br><span class="line"></span><br><span class="line">for i in xrange(4):</span><br><span class="line">    plt.subplot(2,2,i+1),plt.imshow(images[i],&apos;gray&apos;)</span><br><span class="line">    plt.title(titles[i])</span><br><span class="line">    plt.xticks([]),plt.yticks([])</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure></p>
<h3 id="bitwise-not"><a href="#bitwise-not" class="headerlink" title="bitwise_not"></a>bitwise_not</h3><p>像素取反，两次取反回归原图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">img = cv2.imread(&quot;pic.jpg&quot;)</span><br><span class="line">cv2.namedWindow(&quot;Image&quot;)</span><br><span class="line">result = cv2.bitwise_not(img)</span><br><span class="line">cv2.imshow(&quot;Image&quot;, result)</span><br><span class="line">cv2.waitKey(0)</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure></p>
<p><strong>blur</strong><br>低通滤波<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = cv2.blur(img,(5,5))</span><br></pre></td></tr></table></figure></p>
<p>图片变得平滑（模糊）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line"></span><br><span class="line">&quot;显示一个图形&quot;</span><br><span class="line"></span><br><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line"></span><br><span class="line">img = cv2.imread(&quot;pic4.jpg&quot;)</span><br><span class="line">res = cv2.blur(img,(5,5))</span><br><span class="line"></span><br><span class="line">cv2.imshow(&quot;img&quot;,img)</span><br><span class="line">cv2.imshow(&quot;res&quot;,res)</span><br><span class="line">cv2.waitKey(0)</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure></p>
<p>左是处理后的图像，右是原图像<br><img src="http://7xrooc.com1.z0.glb.clouddn.com/blur.png"><br><strong>boxfilter</strong><br>同样也是滤波，效果相同<br>第二个参数-1指的是图像深度由输入图像决定<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = cv2.boxFilter(img, -1, (5,5))</span><br></pre></td></tr></table></figure></p>
<h3 id="高斯模糊"><a href="#高斯模糊" class="headerlink" title="高斯模糊"></a>高斯模糊</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = cv2.GaussianBlur(img,  (5,5), 1.5)</span><br></pre></td></tr></table></figure>
<h3 id="中值滤波"><a href="#中值滤波" class="headerlink" title="中值滤波"></a>中值滤波</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = cv2.medianBlur(img, 5)</span><br></pre></td></tr></table></figure>
<h1 id="VideoCapture"><a href="#VideoCapture" class="headerlink" title="VideoCapture"></a>VideoCapture</h1><h2 id="摄像头"><a href="#摄像头" class="headerlink" title="摄像头"></a>摄像头</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line">import cv2</span><br><span class="line"></span><br><span class="line">#创建一个VideoCapture对象</span><br><span class="line">cap = cv2.VideoCapture(0)</span><br><span class="line"></span><br><span class="line">while(True):</span><br><span class="line">    # 一帧一帧读取</span><br><span class="line">    ret, frame = cap.read()</span><br><span class="line"></span><br><span class="line">    # Our operations on the frame come here</span><br><span class="line">    gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line">    # Display the resulting frame</span><br><span class="line">    cv2.imshow(&apos;frame&apos;,gray)</span><br><span class="line">    if cv2.waitKey(1) &amp; 0xFF == ord(&apos;q&apos;):</span><br><span class="line">        break</span><br><span class="line"></span><br><span class="line"># When everything done, release the capture</span><br><span class="line">cap.release()</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p>首先创建一个VideoCapture对象，参数0用于区别多个，通常只有一个摄像头连接，常用0或-1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ret, fram = cap.read()</span><br></pre></td></tr></table></figure></p>
<p>ret是一个bool值，如果成功读取图像则返回True，可以通过检测ret的值判断是否读取成功<br>有时候，cap可能初始化失败，可以通过<strong>cap.isOpened()</strong>函数判断cap有没有初始化成功<br><strong>cap.get(propld)</strong>函数，可以获得摄像头画面的一些参数<br>propld是0到18的数字，每个数字代表摄像头画面的一个性能参数(如果摄像头支持)<br>有些参数可以通过<strong>cap.set(propld,value)</strong>修改，value是你想自定义的新值</p>
<p>比如使用cap.get(3)和cap.get(4)，获得宽和高<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cap = cv2.VideoCapture(0)</span><br><span class="line">print cap.get(3),cap.get(4)</span><br></pre></td></tr></table></figure></p>
<p>获得的是640 X 480，可以改成320 X 240<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ret = cap.set(3,320)</span><br><span class="line">ret = cap.set(4,240)</span><br></pre></td></tr></table></figure></p>
<h2 id="播放视频文件"><a href="#播放视频文件" class="headerlink" title="播放视频文件"></a>播放视频文件</h2><p>和获取摄像头画面相似，只要把参数改为文件目录<br>当显示视频时，要注意<strong>cv2.waitKey()</strong>的时间参数(单位ms)，如果太短或者太长，视频将会变快或者变慢，正常设置为25ms<br>如果不能播放，确认已经安装了ffmpeg或者gstreamer<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line">import cv2</span><br><span class="line"></span><br><span class="line">cap = cv2.VideoCapture(&quot;/home/herui/mv/badapple.mp4&quot;)</span><br><span class="line"></span><br><span class="line">while(True):</span><br><span class="line">    # Capture frame-by-frame</span><br><span class="line">    ret, frame = cap.read()</span><br><span class="line"></span><br><span class="line">    # Display the resulting frame</span><br><span class="line">    cv2.imshow(&apos;frame&apos;,frame)</span><br><span class="line">    if cv2.waitKey(25) &amp; 0xFF == ord(&apos;q&apos;):</span><br><span class="line">        break</span><br><span class="line"></span><br><span class="line"># When everything done, release the capture</span><br><span class="line">cap.release()</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure></p>
<h2 id="保存视频文件"><a href="#保存视频文件" class="headerlink" title="保存视频文件"></a>保存视频文件</h2><p>保存视频文件必须要指定文件名，FourCC，每秒的帧数(fps)以及每帧大小，还有isColor标识<br>FourCC是一个4-byte编码，用来指定视频编码器<br>FourCC使用cv2.VideoWriter_fourcc(‘M’,’J’,’P’,’G’)或者cv2.VideoWriter_fourcc(*’MJPG’)指定MJPG<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line">import cv2</span><br><span class="line"></span><br><span class="line">cap = cv2.VideoCapture(0)</span><br><span class="line"></span><br><span class="line">print cap.get(3),&apos;*&apos;,cap.get(4)</span><br><span class="line"></span><br><span class="line">#定义编码器，创建视频写对象</span><br><span class="line">fourcc = cv2.VideoWriter_fourcc(*&apos;XVID&apos;)</span><br><span class="line">out = cv2.VideoWriter(&quot;output.avi&quot;, fourcc,25.0,(640,480))</span><br><span class="line"></span><br><span class="line">while(cap.isOpened()):</span><br><span class="line">    ret, frame = cap.read()</span><br><span class="line">    if ret == True:</span><br><span class="line">        #写帧</span><br><span class="line">        out.write(frame)</span><br><span class="line"></span><br><span class="line">        cv2.imshow(&apos;frame&apos;,frame)</span><br><span class="line">        if cv2.waitKey(50) &amp; 0xFF == ord(&apos;q&apos;):</span><br><span class="line">            break</span><br><span class="line">    else:</span><br><span class="line">        break</span><br><span class="line"></span><br><span class="line">#release everything</span><br><span class="line">cap.release()</span><br><span class="line">out.release()</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure></p>
<h1 id="matplotlib"><a href="#matplotlib" class="headerlink" title="matplotlib"></a>matplotlib</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>matplotlib是python的一个绘图库，具有和matlab相似的API</p>
<h1 id="图像转换"><a href="#图像转换" class="headerlink" title="图像转换"></a>图像转换</h1><h2 id="cv2-image-to-PIL-image"><a href="#cv2-image-to-PIL-image" class="headerlink" title="cv2 image to PIL image"></a>cv2 image to PIL image</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">img = cv2.imread(&quot;pic.jpg&quot;)</span><br><span class="line">img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)</span><br><span class="line">pil_img = Image.fromarray(img)</span><br><span class="line">pil_img.show()</span><br></pre></td></tr></table></figure>
<h2 id="PIL-image-to-cv2-image"><a href="#PIL-image-to-cv2-image" class="headerlink" title="PIL image to cv2 image"></a>PIL image to cv2 image</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">out = Image.open(src).convert(&quot;RGB&quot;)</span><br><span class="line">cv_img = np.array(out)</span><br><span class="line">cv_img = cv2.cvtColor(cv_img, cv2.COLOR_BGR2RGB)</span><br></pre></td></tr></table></figure>
<h1 id="PIL-filter"><a href="#PIL-filter" class="headerlink" title="PIL filter"></a>PIL filter</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image,ImageFilter</span><br><span class="line"> </span><br><span class="line">#滤镜名称   含义</span><br><span class="line">#ImageFilter.BLUR   模糊滤镜</span><br><span class="line">#ImageFilter.CONTOUR    轮廓</span><br><span class="line">#ImageFilter.EDGE_ENHANCE   边界加强</span><br><span class="line">#ImageFilter.EDGE_ENHANCE_MORE  边界加强(阀值更大)</span><br><span class="line">#ImageFilter.EMBOSS     浮雕滤镜</span><br><span class="line">#ImageFilter.FIND_EDGES     边界滤镜</span><br><span class="line">#ImageFilter.SMOOTH     平滑滤镜</span><br><span class="line">#ImageFilter.SMOOTH_MORE    平滑滤镜(阀值更大)</span><br><span class="line">#ImageFilter.SHARPEN    锐化滤镜</span><br><span class="line"></span><br><span class="line">def filterDemo():  </span><br><span class="line">    img = Image.open(&quot;pic4.jpg&quot;)  </span><br><span class="line">    #img = inHalf(img)  </span><br><span class="line">    imgfilted = img.filter(ImageFilter.SHARPEN)  </span><br><span class="line">    #imgfilted.show()  </span><br><span class="line">    imgfilted.save(&quot;pic4_1.jpg&quot;)  </span><br><span class="line">  </span><br><span class="line">if __name__ == &quot;__main__&quot;:  </span><br><span class="line">    filterDemo()</span><br></pre></td></tr></table></figure>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="http://blog.csdn.net/column/details/opencv-tutorial.html" target="_blank" rel="noopener">http://blog.csdn.net/column/details/opencv-tutorial.html</a><br><a href="http://blog.csdn.net/sunny2038/article/details/9057415" target="_blank" rel="noopener">http://blog.csdn.net/sunny2038/article/details/9057415</a><br><a href="http://opencv-python-tutroals.readthedocs.org/en/latest/py_tutorials/py_gui/py_video_display/py_video_display.html" target="_blank" rel="noopener">http://opencv-python-tutroals.readthedocs.org/en/latest/py_tutorials/py_gui/py_video_display/py_video_display.html</a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2016-03-29</span><i class="fa fa-tag"></i><a class="tag" href="/tags/python/" title="python">python </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,http://yoursite.com/2016/03/29/Note/python/library/data/opencv/,Harryx,opencv,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2016/04/01/Note/python/library/data/numpy/" title="numpy">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2016/03/27/Note/python/library/gui/tkinter/" title="Tkinter">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>