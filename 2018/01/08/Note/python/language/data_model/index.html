<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Ben Wong,wenbinben@gmail.com"><title>数据模式 · Harryx</title><meta name="description" content="文档
特殊方法名通过定义特殊名称的方法，类可以使用特定语法实现特定操作。这是Python的运算符重载，允许类定义自己的运算符行为。可以设置一个特殊方法为None标识相应操作不可用。
基础定制方法object.__new__(cls[, ...])
一个静态方法，用于创建一个类的实例，第一个参数是这个"><meta name="keywords" content="Hexo,HTML,Ben,CSS,安卓,android,Linux,linuxdeepin"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title><a href="/">Harryx</a></h3><div class="description"><p>good good study good good play~</p></div></div></div><ul class="social-links"><li><a href="https://twitter.com/harryx520"><i class="fa fa-twitter"></i></a></li><li><a href="http://weibo.com/Booooyakasha"><i class="fa fa-weibo"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/links">友链</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div><div class="avatar"><img src="/images/avator.jpg"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>数据模式</a></h3></div><div class="post-content"><p><a href="https://docs.python.org/3/reference/datamodel.html" target="_blank" rel="noopener">文档</a></p>
<h1 id="特殊方法名"><a href="#特殊方法名" class="headerlink" title="特殊方法名"></a>特殊方法名</h1><p>通过定义特殊名称的方法，类可以使用特定语法实现特定操作。这是Python的运算符重载，允许类定义自己的运算符行为。可以设置一个特殊方法为None标识相应操作不可用。</p>
<h2 id="基础定制方法"><a href="#基础定制方法" class="headerlink" title="基础定制方法"></a>基础定制方法</h2><p><code>object.__new__(cls[, ...])</code></p>
<p>一个静态方法，用于创建一个类的实例，第一个参数是这个实例的类。剩下的参数用于传递给对象的构造表达式，然后由类调用。返回值应该是一个新的实例，一般返回<code>cls</code>的实例。</p>
<p>典型的实现是传入适当的参数，通过调用父类的<code>__new__()</code>方法创建实例，形如<code>super().__new__(cls[, ...])</code>，然后在返回之前对实例进行修改。</p>
<p>如果<code>__new__()</code>返回<code>cls</code>的实例，然后实例的<code>__init__()</code>方法会被调用，形如<code>__init__(self[, ...])</code>其中<code>self</code>是新创建的实例。</p>
<p>如果<code>__new__()</code>不返回<code>cls</code>的实例，那么实例的<code>__init__()</code>方法不会被调用。</p>
<p><code>__new__()</code>主要用于允许不可变类型（比如int，str或者tuple）的子类创建自定义实例。通常在自定义元类中为了创建自定义元类被重写。</p>
<p>可以用于实现单例模式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class SingleClass(object):</span><br><span class="line">    def __new__(cls, *args, **kwargs):</span><br><span class="line">        if not hasattr(cls, &apos;_ins&apos;):</span><br><span class="line">            cls._ins = super(SingleClass, cls).__new__(cls, *args, **kwargs)</span><br><span class="line">        return cls._ins</span><br><span class="line"></span><br><span class="line">    def __init__(self):</span><br><span class="line">        print(&apos;do init&apos;)</span><br></pre></td></tr></table></figure>

<p>测试一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s=SingleClass()</span><br><span class="line">do init</span><br><span class="line">&gt;&gt;&gt; c=SingleClass()</span><br><span class="line">do init</span><br><span class="line">&gt;&gt;&gt; s</span><br><span class="line">&lt;main.SingleClass object at 0x000001F10EDFE390&gt;</span><br><span class="line">&gt;&gt;&gt; c</span><br><span class="line">&lt;main.SingleClass object at 0x000001F10EDFE390&gt;</span><br></pre></td></tr></table></figure>

<p>虽然实现了单例模式，但是注意的是，每次创建一个实例都会调用一次<code>__init__()</code>方法。</p>
<p><code>object.__init__(self[, ...])</code></p>
<p>当实例被创建后(也就是<code>__new__()</code>方法调用之后)，返回给调用者之前调用。参数是传递给类构造器的参数。如果基类含有一个<code>__init__()</code>方法，派生类的<code>__init__()</code>方法必须显式调用父类的<code>__init__()</code>方法以确保基类部分正确初始化。比如<code>super(Derived, self).__init__([args...])</code>。</p>
<p><code>object.__del__(self)</code></p>
<p>当实例即将被销毁时调用，如果基类有<code>__del__()</code>方法，派生类的<code>__del__()</code>方法必须显式调用父类的<code>__del__()</code>方法以确保销毁实例的父类部分。</p>
<p>可以同过在<code>__del__()</code>方法中再创建一个对象的引用来”复活”对象（不推荐）。</p>
<p>并不保证在解释器退出时<code>__del__()</code>方法还存在。</p>
<p><code>del x</code>并不直接调用<code>x.__del__()</code>，只是将引用计数减1，当引用计数为0时才调用。</p>
<p><code>object.__repr(self)</code></p>
<p>由<code>repr()</code>方法以及<code>&#39;%r&#39;%object</code>调用，用于返回一个对象的可打印字符串，返回值传递给<code>eval()</code>可以获得该对象。</p>
<p><code>object.__str__(self)</code></p>
<p>由<code>str(object)</code>、<code>format()</code>和<code>print()</code>调用，将对象进行字符串表示，返回值必须是一个字符串对象。和<code>__repr__()</code>不同的是，<code>__str__()</code>不一定返回有效的Python表达式。当没有定义<code>__str__()</code>时，解释器会用<code>__repr__()</code>代替。</p>
<p><code>object.__bytes__(self)</code></p>
<p>由bytes类调用，计算对象的bytes字符串表示，应该返回一个bytes对象。比如将一个数值加上头和尾返回bytes字符串。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class Test(object):</span><br><span class="line">    def __init__(self, val):</span><br><span class="line">        self.val = val</span><br><span class="line"></span><br><span class="line">    def __bytes__(self):</span><br><span class="line">        return bytes([0x00, int(self.val), 0x00])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; t=Test(1)</span><br><span class="line">&gt;&gt;&gt; bytes(t)</span><br><span class="line">b&apos;\x00\x01\x00&apos;</span><br></pre></td></tr></table></figure>

<p><code>object.__format__(self, format_spec)</code></p>
<p>由<code>format()</code>调用，<code>format(15, &#39;02x&#39;)</code>相当于<code>int.__format__(15, &#39;02x&#39;)</code>，返回<code>0f</code>。</p>
<p><code>object.__lt__(self, other)</code><br><code>object.__le__(self, other)</code><br><code>object.__eq__(self, other)</code><br><code>object.__ne__(self, other)</code><br><code>object.__gt__(self, other)</code><br><code>object.__ge__(self, other)</code></p>
<p>各种比较操作。</p>
<p><code>object.__hash__()</code></p>
<p>由<code>hash()</code>调用，如果x==y，那么hash(x) == hash(y)。</p>
<h2 id="属性接口"><a href="#属性接口" class="headerlink" title="属性接口"></a>属性接口</h2><p>属性接口用于获取类实例的属性。</p>
<p><code>object.__getattr__(self, name)</code></p>
<p>当通过通常的方式没有找到属性时(即不是实例的属性也不是类属性)调用。</p>
<p><code>object.__getattribute__(self, name)</code></p>
<p>当需要获取参数时无条件执行。<br>如果同时定义了<code>__getattr__()</code>和<code>__getattribute__()</code>，除非<code>__getattribute__()</code>显式指定或者抛出<code>AttributeError</code>，否则<code>__getattr__()</code>将不会被调用。</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-01-08</span><i class="fa fa-tag"></i><a href="/tags/python/" title="python" class="tag">python </a></div></div></div></div><div class="share"><div class="evernote"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"><a href="http://twitter.com/home?status=,http://yoursite.com/2018/01/08/Note/python/language/data_model/,Harryx,数据模式,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2018/01/23/Note/python/library/coroutine/subprocess/" title="subprocess" class="btn">上一篇</a></li><li class="next pagbuttons"><a role="navigation" href="/2018/01/02/Note/python/library/data/random/" title="伪随机" class="btn">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>